<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>subforum</title>
</head>

<style>

    body{
        background-color: lightpink;
    }

    h1{
        color: white;
    }

    a.button {
        -webkit-appearance: button;
        -moz-appearance: button;
        appearance: button;

        text-decoration: none;
        color: initial;
    }

</style>

<body>

<h1 id = "forumName"></h1>

<p>Links to threads in the forum:</p>

<ul id="listsCorrespThreads">

</ul>

<a href="new-thread.html" class="button">Create new Thread</a>



<script>

    (function getForumName() {
        let req = new XMLHttpRequest();
        var url = window.location.search;
        var queryParam = new URLSearchParams(url);
        var subforumId = queryParam.get("id");
        req.open("GET", `http://localhost:3000/subforums/${subforumId}`);
        req.addEventListener("load", forumNameHandler);
        req.send();
    })();

    let req = new XMLHttpRequest();
    var url = window.location.href;
    var queryParam = new URLSearchParams(url);
    var subforumId = queryParam.get("id");
    req.open("GET", `http://localhost:3000/thread?subforum=${subforumId}`);
    req.addEventListener("load", handleThreadReponse);
    req.send();

    function handleThreadReponse() {
        var reponseT = JSON.parse(this.responseText);
        let list = document.getElementById("listsCorrespThreads");
        for(obj of reponseT) {
            let item = document.createElement("li");
            var threadId = obj.id;
            item.innerHTML =`<a href="thread.html?id=${threadId}">${obj.threadName}</a>`;
            list.appendChild(item);
        }

    }

    function forumNameHandler() {
        if(this.status == 200) {
            var response = JSON.parse(this.responseText);
            var forumTitle = response.title;
            let header = document.getElementById("forumName");
            if(forumTitle !== null && forumTitle !== undefined) {
                header.innerText = forumTitle;
            }
            else {
                header.innerText = "FORUM";
            }

        }
    }



</script>


</body>
</html>