<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DI Forum</title>
</head>
<body>
<form id="subforum">
    Title:<br>
    <input type ="text" title="title" id="titleinput">
    <br>
    <button>submit</button>
    <ul id="subforums"> </ul>

    <label for="subforum-select">List of Subforums: </label>
    <select id="subforum-select">
        <option value="">No parent forum</option>
    </select>
</form>
<form id="updateForm">
    <button id="updateButton">update</button>
</form>


<script>

    const form = document.getElementById("subforum");
    form.addEventListener("submit",(event)=> {
        event.preventDefault();
        const title = document.getElementById('titleinput').value;
        const id = document.getElementById('subforum-select').value;
        createSubforum(title, id);
    });

    function createSubforum(title, parentForumId) {
        console.log(title, parentForumId);

        let data = {
            title:title,
            parentid:parentForumId
        }
        let req = new XMLHttpRequest();

        req.addEventListener("load", () => {
            console.log(req.responseText);
        })
        req.open("POST", "http://localhost:3000/subforums");
        req.setRequestHeader('Content-Type', 'application/json');
        req.send(JSON.stringify(data));

    }

    const updateForm = document.getElementById("updateForm");
    updateForm.addEventListener("submit",(event)=> {
        event.preventDefault();
        printSubForums();

    });

    function printSubForums() {
        getSubforum(forums => {
            console.log(forums);
            // TODO Print list of subforums for selection
        })
    }

    function getSubforum(cb) {
        let req = new XMLHttpRequest();
        req.addEventListener("load", () => {
            console.log(req.responseText);
            const forums = JSON.parse(req.responseText);
            cb(forums);
        });
        req.open("GET", "http://localhost:3000/subforums");
        req.send();
    }

    function getSubforumList() {
        getSubforum((forums) => {
            console.log(forums);
            for(let i =0; i < forums.length; i++) {
                const f = forums[i];
                const option = document.createElement("option");
                option.value = f.id;
                option.innerText = f.title;
                document.getElementById("subforum-select").appendChild(option);
            }

        })

    }

    getSubforumList();

</script>
</body>
</html>

